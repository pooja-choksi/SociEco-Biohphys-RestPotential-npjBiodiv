---
title: "People-centric restoration: Reporting district level results and figures"
author: "Pooja Choksi"
date: '2022-06-24'
output: html_document
---

USING THE DATA FROM PREVIOUS SCRIPT, CHUNKS OF CODE BELOW REPORT THE RESULTS AND FIGURES IN THE PAPER

```{r setup, include=FALSE}

library(data.table)
library(dplyr)
library(tidyr)
library(tools)
library(ggplot2)

```

READ IN ALL THE DATA

```{r message=FALSE, warning=FALSE, include=TRUE}

district_mpi_summary = read.csv("District-MPI-Combined.csv")

aspirational_districts = read.csv("Aspirational-Districts-Phase1.csv")
```

COMBINE ASPIRATIONAL DISTRICTS DATA TO MAIN DATASET

```{r message =FALSE, warning=FALSE, include=TRUE}

#Make a variable for the presence of aspirational district
aspirational_districts$Aspirational_District = "Aspirational_district"

#recode districts to match with the main dataset 
aspirational_districts = aspirational_districts%>%dplyr::mutate(District.name = recode(District.name, 
"West singhbhum" ="Pashchimi Singhbhum", 
"Chatttarpur" = "Chhatarpur",
"East nimar" = "East Nimar",
"Gadchiroli" = "Garhchiroli",
"Nuapara" = "Nuapada",
"Ferozepur" = "Firozpur",
"Dholpur" = "Dhaulpur",
"Virudhunagar" = "Virudunagar",
"Haridwar" = "Hardwar",
"Udham singh nagar" = "Udham Singh Nagar",
"Dakshin dinajpur" = "Dakshin Dinajpur"))

#Combine aspiration districts with the main dataset
district_mpi_summary = merge(district_mpi_summary, aspirational_districts[c("District.name", "S.NO.", "Aspirational_District")], by.x = c("District_Name", "State"), 
              by.y =c("District.name", "S.NO."), all.x=T)

#74 aspirational districts 
```

RESULTS TO REPORT IN THE PAPER 
We look at the top and bottom quantile of the scaled biophysical potential and MPI and discuss restoration methods which are appropriate for different land tenure regimes in more detail

1. CREATE THE DFS FOR TOP AND BOTTOM DISTRICTS 

```{r message=FALSE, warning=FALSE, include=TRUE}

#1. Living standards of MPI scale 
summary(district_mpi_summary$Living_standards_scaled)
#1st q = 0.6182
#3rd q = 0.7870

top_districts_mpi = district_mpi_summary%>%filter(Living_standards_scaled>0.7870)

```

QUESTION: Which land tenures within districts provide the largest number of hectares for restoration? 

This is the chunk of code used to create Figure 3

```{r message=FALSE, warning=FALSE, include=TRUE}

#How many districts have forest and commons as their max category? 
top_districts$tenure_max  = apply(top_districts[c("Total_Indiv_sum", "Total_Common_sum", "Total_Forest_sum")], 1, max)

top_districts_tenure = top_districts%>%mutate(tenure_max_cat = 
 case_when(tenure_max == Total_Indiv_sum ~ "Individual",
           tenure_max == Total_Common_sum ~ "Common",
           tenure_max == Total_Forest_sum ~ "Forest", 
           TRUE ~ "NA"))

#wide to long
top_district_long = reshape(top_districts, direction='long', varying=c('Total_Indiv_sum', 'Total_Common_sum', 'Total_Forest_sum', 'Total_Unaccounted_sum'), timevar= 'Land_Tenure', times=c('Individual', 'Common_NonForest', 'Forest', 'Unaccounted'),
v.names= 'Total_Hectares',
idvar=c('State', 'Total_Population_sum', 'X', "MPI_District", "Number_of_MPI_PeopleDistrict", "Living_standards", "MPI_rank", "Vulnerability_Rank", "Mean_Rank", "Mean_Rank_Scaled", "Total_hectares_for_prop_sum", "District_Name",
        "Total_Household_sum", "forests_land_sum", "non_agricultural_land_sum", "barren_uncultivable_land_sum", 
        "pasture_grazing_land_sum", "misc_tree_crop_land_sum",
        "culturable_wasteland_sum", "fallow_other_than_current_fallow_land_sum", "net_sown_area_sum", "current_fallow_land_sum", "total_irrigated_land_sum", "total_unirrigated_land_sum", "District_Code", "State_Code", 
        "Climate_vulnerability_index", "Combined_Rank", 
        "People_centric_Mean", "People_Centric_Rank"))

#plot of the distribution of land tenure in top districts
tenure_topdistricts = ggplot()+geom_histogram(data= top_districts, aes(x=Total_Forest_sum), fill ="#117733", alpha=0.5, binwidth = 300000)+geom_histogram(data = top_districts, aes(x=Total_Common_sum), fill = "#999933", alpha =0.5, binwidth = 300000)+ geom_histogram(data = top_districts, aes(x= Total_Indiv_sum), fill = "#E69F00", alpha= 0.5, binwidth = 300000)+ theme_classic()+ theme(axis.text.x = element_text(angle = 45, hjust = 1))+ labs(x = "Total number of hectares", y = "Freqeuncy")

tenure_topdistricts

#reporting % of land tenure in each district 
tenure_topdistricts_report = top_district_long%>%group_by(Land_Tenure)%>%summarise(hectares_category = sum(Total_Hectares))

tenure_topdistricts_report= tenure_topdistricts_report%>%mutate(tenure_total = colSums(tenure_topdistricts_report[,-1])) 

tenure_topdistricts_report = tenure_topdistricts_report%>%mutate(tenure_prop = (hectares_category/tenure_total)*100)
# refer to DF to report the top districts

```
