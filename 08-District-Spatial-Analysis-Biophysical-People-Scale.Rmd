---
title: "People-centric restoration: Comparing district level biophysical potential with the people-centric restoration potential"
author: "Pooja Choksi"
date: '2022-06-24'
output: html_document
---

```{r setup, include=FALSE}

library(data.table)
library(dplyr)
library(tidyr)
library(sf)
library(rgdal)
library(raster)
library(tools)
library(sp)
library(ggplot2)
```

READ IN ALL THE RASTERS FROM THE BIOPHYSICAL POTENTIAL STUDIES AND DISTRICT SHAPEFILE FROM PREVIOUS CODE

```{r message=TRUE, warning=TRUE, include=TRUE}

#rasters for three studies we're comparing our scale with
brancalion <- raster("C:\\Users\\pooja\\Documents\\GitHub\\Land-Tenure-Restoration-Potential\\Land-Tenure-Restoration-Potential\\Restoration_Potential_Studies\\India_Clipped\\Brancalion_India_Clipped.tif")

strassburg = raster("C:\\Users\\pooja\\Documents\\GitHub\\Land-Tenure-Restoration-Potential\\Land-Tenure-Restoration-Potential\\Restoration_Potential_Studies\\India_Clipped\\Strassburg_india_Clipped.tif")

wri = raster("C:\\Users\\pooja\\Documents\\GitHub\\Land-Tenure-Restoration-Potential\\Land-Tenure-Restoration-Potential\\Restoration_Potential_Studies\\India_Clipped\\Potapov_India_Clipped.tif")

#district shapefile with info on the people-centric variables
districts = readOGR("C:\\Users\\pooja\\Documents\\GitHub\\Land-Tenure-Restoration-Potential\\Land-Tenure-Restoration-Potential\\Census2011-District-Shapefiles\\District-MPI-Climate-Pop-Merged-V3.shp")
  
```

EXTRACT MEAN BIOPHYSICAL POTENTIAL FOR EACH DISTRICT AND RANK DISTRICTS ACCORDING TO BIOPHYSICAL POTENTIAL

```{r message=FALSE, warning=FALSE, include=TRUE}

#remove the districts which don't have a value for climate vulnerability 
districts <- districts[!is.na(districts$clmt_v_),]
#N = 452 after removing the districts without CV 

#extract mean or majority (for wri data) of raster for each district
brancalion_extracted = raster::extract(brancalion, districts, fun = mean, na.rm = T, small = T, sp=TRUE)
brancalion_extracted_df <- as(brancalion_extracted, "data.frame")

strassburg_extracted = raster::extract(strassburg, districts, fun = mean, na.rm = T, small = T, sp=TRUE)
strassburg_extracted_df <- as(strassburg_extracted, "data.frame")

wri_extracted = raster::extract(wri, districts, fun= modal, na.rm = T, small= T, sp=TRUE)
wri_extracted_df <- as(wri_extracted, "data.frame")

#combine the data of extracted values 
potential_extracted = merge(brancalion_extracted_df, strassburg_extracted_df[c("Strassburg_India_Clipped", "NAME_1", "NAME_2")], by.x = c("NAME_2", "NAME_1"), by.y =c("NAME_2", "NAME_1"))
                            
#combine the data of extracted values 
potential_extracted = merge(potential_extracted, wri_extracted_df[c("Potapov_India_Clipped", "NAME_2", "NAME_1")], by.x = c("NAME_2", "NAME_1"), by.y =c("NAME_2", "NAME_1"))

#rank the districts as per their biophysical potential 
#1. Brancalion
#reorder the districts in descending order of MPI
potential_extracted  <- potential_extracted [order(potential_extracted$Brancalion_India_Clipped, decreasing=TRUE),]

#assign each district a rank
potential_extracted= potential_extracted%>% mutate(branca_rank = match(Brancalion_India_Clipped, unique(Brancalion_India_Clipped)))

#2. Potapov:
#reorder the districts in descending order of MPI
potential_extracted  <- potential_extracted [order(potential_extracted$Potapov_India_Clipped, decreasing=TRUE),]

#assign each district a rank
potential_extracted= potential_extracted%>% mutate(wri_rank = match(Potapov_India_Clipped, unique(Potapov_India_Clipped)))

#3. Strassburg
#reorder the districts in descending order of MPI
potential_extracted  <- potential_extracted [order(potential_extracted$Strassburg_India_Clipped, decreasing=TRUE),]

#assign each district a rank
potential_extracted= potential_extracted%>% mutate(strass_rank = match(Strassburg_India_Clipped, unique(Strassburg_India_Clipped)))

#merge the extracted data with districts shapefile
districts = sp::merge(districts, potential_extracted[c("strass_rank", "branca_rank", "wri_rank","Potapov_India_Clipped", "Strassburg_India_Clipped", "Brancalion_India_Clipped", "NAME_1", "NAME_2")], by.x = c("NAME_1","NAME_2"), by.y= c("NAME_1", "NAME_2"))

writeOGR(districts, layer = "districts", dsn= "District-MPI-Climate-Pop-Merged-Biophys.shp", driver = "ESRI Shapefile")

#also create a dataframe from the shapefile to use for analysis below 
districts_df <- as(districts, "data.frame")

write.csv(districts_df, "District-Climate-MPI-Biophys-Ranked.csv")

```
