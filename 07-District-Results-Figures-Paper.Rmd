---
title: "People-centric restoration: Reporting district level results and figures"
author: "Pooja Choksi"
date: '2022-06-24'
output: html_document
---

USING THE DATA FROM PREVIOUS SCRIPT, CHUNKS OF CODE BELOW REPORT THE RESULTS AND FIGURES IN THE PAPER

```{r setup, include=FALSE}

library(data.table)
library(dplyr)
library(tidyr)
library(tools)
library(ggplot2)

```

Read in the data from previous script which has the districts ranked according to 
1. Climate vulnerability 
2. Total population 
3. MPI 
4. A combination of all variables 

It also has district level land tenure data

```{r message=FALSE, warning=FALSE, include=TRUE}

district_mpi_climate_summary = read.csv("District-Climate-MPI-Ranked.csv")

aspirational_districts = read.csv("Aspirational-Districts-Phase1.csv")
```

COMBINE ASPIRATIONAL DISTRICTS DATA TO MAIN DATASET

```{r message =FALSE, warning=FALSE, include=TRUE}

#Make a variable for the presence of aspirational district
aspirational_districts$Aspirational_District = "Aspirational_district"

#recode districts to match with the main dataset 
aspirational_districts = aspirational_districts%>%dplyr::mutate(District.name = recode(District.name, 
"West singhbhum" ="Pashchimi Singhbhum", 
"Chatttarpur" = "Chhatarpur",
"East nimar" = "East Nimar",
"Gadchiroli" = "Garhchiroli",
"Nuapara" = "Nuapada",
"Ferozepur" = "Firozpur",
"Dholpur" = "Dhaulpur",
"Virudhunagar" = "Virudunagar",
"Haridwar" = "Hardwar",
"Udham singh nagar" = "Udham Singh Nagar",
"Dakshin dinajpur" = "Dakshin Dinajpur"))

#Combine aspiration districts with the main dataset
district_mpi_climate_summary = merge(district_mpi_climate_summary, aspirational_districts[c("District.name", "S.NO.", "Aspirational_District")], by.x = c("District_Name", "State"), 
              by.y =c("District.name", "S.NO."), all.x=T)

#74 aspirational districts 
```
RESULTS TO REPORT IN THE PAPER 
We look at the top and bottom quantile of the mean rank of districts and discuss restoration methods which are appropriate for different land tenure regimes in more detail

1. CREATE THE DFS FOR TOP AND BOTTOM DISTRICTS 

```{r message=FALSE, warning=FALSE, include=TRUE}

#1. People centric restoration scale 
#The mean of living stands MPI and the climate vulnerability 
#using this in final figures as it is the least amount of conversion of data
summary(district_mpi_climate_summary$People_centric_Mean)
#1st q = 0.5361
#3rd q = 0.7067

top_districts = district_mpi_climate_summary%>%filter(People_centric_Mean>0.7067)

high_districts = district_mpi_climate_summary%>%filter(People_centric_Mean>0.7067)

middle_districts = district_mpi_climate_summary%>%filter(People_centric_Mean >0.5361 & People_centric_Mean<0.7067)

#2. Living standards of MPI scale 
summary(district_mpi_climate_summary$Living_standards_scaled)
#1st q = 0.6182
#3rd q = 0.7870

top_districts_mpi = district_mpi_climate_summary%>%filter(People_centric_Mean>0.7870)

#3. Climate vulnerability scale
summary(district_mpi_climate_summary$Climate_vulnerability_scaled)
#1st q = 0.4279
#3rd q = 0.6650

top_districts_climate = district_mpi_climate_summary%>%filter(People_centric_Mean>0.6650)

```

QUESTION 1: Which are the districts that should be prioritized when considering the following variables: (a) maximum population, (c) Multidimensional poverty index, (b) climate vulnerability index and (d) a combination of the variables?

PLOT OF THE STATES IN WHICH WE FIND THE TOP DISTRICTS 

```{r message= FALSE, warning=FALSE, include=TRUE}

#1. people-centric restoration scale 
#Which states make up the top quantile of districts for people centrict restoration?
top_states = top_districts%>%group_by(State)%>%count()
  
#plot in descending order#assign order to prop variable
prop_order <-
  top_states%>%
  arrange(desc(n)) %>%
  mutate(State = factor(State))

topstates_plot = top_states%>%mutate(State = factor(State, levels = prop_order$State, ordered = TRUE))%>%ggplot(aes(x= State, y = n))+geom_col(aes(x=State), fill = "#440154FF")+theme_classic()+ theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  labs(x = "State/ Union Territory", y = "Number of districts")

topstates_plot

#2. Living standards of MPI scale 
#Which states make up the top quartile of districts for living standards poverty?
top_states_mpi = top_districts_mpi%>%group_by(State)%>%count()

#3. Climate vulnerability 
#Which states make up the top quartile of districts for climate vulnerability?
top_states_climate = top_districts_climate%>%group_by(State)%>%count()

```

QUESTION 2: Which land tenures within districts provide the largest number of hectares for restoration?

PLOT OF THE DISTRIBUTION OF EACH LAND TENURE IN THE TOP DISTRICTS AND REPORT % of LAND TENURE IN TOP DISTRICTS

```{r message=FALSE, warning=FALSE, include=TRUE}

#How many districts have forest and commons as their max category? 
top_districts$tenure_max  = apply(top_districts[c("Total_Indiv_sum", "Total_Common_sum", "Total_Forest_sum")], 1, max)

top_districts_tenure = top_districts%>%mutate(tenure_max_cat = 
 case_when(tenure_max == Total_Indiv_sum ~ "Individual",
           tenure_max == Total_Common_sum ~ "Common",
           tenure_max == Total_Forest_sum ~ "Forest", 
           TRUE ~ "NA"))

#wide to long
top_district_long = reshape(top_districts, direction='long', varying=c('Total_Indiv_sum', 'Total_Common_sum', 'Total_Forest_sum', 'Total_Unaccounted_sum'), timevar= 'Land_Tenure', times=c('Individual', 'Common_NonForest', 'Forest', 'Unaccounted'),
v.names= 'Total_Hectares',
idvar=c('State', 'Total_Population_sum', 'X', "MPI_District", "Number_of_MPI_PeopleDistrict", "Living_standards", "MPI_rank", "Vulnerability_Rank", "Mean_Rank", "Mean_Rank_Scaled", "Total_hectares_for_prop_sum", "District_Name",
        "Total_Household_sum", "forests_land_sum", "non_agricultural_land_sum", "barren_uncultivable_land_sum", 
        "pasture_grazing_land_sum", "misc_tree_crop_land_sum",
        "culturable_wasteland_sum", "fallow_other_than_current_fallow_land_sum", "net_sown_area_sum", "current_fallow_land_sum", "total_irrigated_land_sum", "total_unirrigated_land_sum", "District_Code", "State_Code", 
        "Climate_vulnerability_index", "Combined_Rank", 
        "People_centric_Mean", "People_Centric_Rank"))

#plot of the distribution of land tenure in top districts
tenure_topdistricts = ggplot()+geom_histogram(data= top_districts, aes(x=Total_Forest_sum), fill ="#117733", alpha=0.5, binwidth = 300000)+geom_histogram(data = top_districts, aes(x=Total_Common_sum), fill = "#999933", alpha =0.5, binwidth = 300000)+ geom_histogram(data = top_districts, aes(x= Total_Indiv_sum), fill = "#E69F00", alpha= 0.5, binwidth = 300000)+ theme_classic()+ theme(axis.text.x = element_text(angle = 45, hjust = 1))+ labs(x = "Total number of hectares", y = "Freqeuncy")

tenure_topdistricts

#reporting % of land tenure in each district 
tenure_topdistricts_report = top_district_long%>%group_by(Land_Tenure)%>%summarise(hectares_category = sum(Total_Hectares))

tenure_topdistricts_report= tenure_topdistricts_report%>%mutate(tenure_total = colSums(tenure_topdistricts_report[,-1])) 

tenure_topdistricts_report = tenure_topdistricts_report%>%mutate(tenure_prop = (hectares_category/tenure_total)*100)

#see DF to report the distribution


##DISTRICT PLOT WITH SATURATION CURVES

#rearrange tenure common in descending order
top_dists_rearranged <- top_districts[order(top_districts$Total_hectares_for_prop_sum, decreasing=TRUE),]

#add cumulative column to the data frame
top_dists_rearranged[,"cum_indiv_hectares"] <- cumsum(top_dists_rearranged$Total_Indiv_sum)

top_dists_rearranged[,"cum_common_hectares"] <- cumsum(top_dists_rearranged$Total_Common_sum)

top_dists_rearranged[,"cum_forest_hectares"] <- cumsum(top_dists_rearranged$Total_Forest_sum)

top_dists_rearranged[,"cum_unaccounted_hectares"] <- cumsum(top_dists_rearranged$Total_Unaccounted_sum)

top_dists_rearranged[,"cum_total_population"] <- cumsum(top_dists_rearranged$Total_Population_sum)

#find duplicate district names
duplicated_districts = 
top_dists_rearranged[duplicated(top_dists_rearranged$District_Name), ]

#rename the duplicate districts to be able to plot in descending 
top_dists_rearranged = top_dists_rearranged%>%mutate(District_Name = case_when(District_Name == "Aurangabad" & State == "Bihar" ~ "Aurangabad_2", District_Name == "Bijapur" & State == "Karnataka" ~ "Bijapur_2", District_Name == "Bilaspur" & State == "Himachal Pradesh" ~ "Bilaspur_2", District_Name == "Hamirpur" & State== "Himachal Pradesh"~ "Hamirpur_2", District_Name == "Pratapgarh" & State == "Rajasthan" ~ "Pratapgarh_2", District_Name== "Raigarh" & State == "Maharashtra" ~ "Raigarh_2", District_Name == "Ranchi" & State == "Madhya Pradesh" ~ "Ranchi_2", TRUE ~ District_Name))

#plot in descending order#assign order to prop variable
prop_order <-
  top_dists_rearranged %>%
  arrange(desc(Total_hectares_for_prop_sum)) %>%
  mutate(District_Name = factor(District_Name))

#plot decreasing pop and cumulative hectares 
scaleRight = 35

topdistrict_tenure_curves  = top_dists_rearranged%>%mutate(District_Name = factor(District_Name, levels= prop_order$District_Name, ordered =TRUE))%>%
  ggplot(aes(x = District_Name, y = Total_hectares_for_prop_sum))+ 
  geom_col(aes(x = District_Name, y = Total_hectares_for_prop_sum, fill = State)) + 
    #geom_line(aes(x = State, y= cum_hectares, group = 1)) + 
 #geom_line(aes(y= cum_total_population/scaleRight), group = 1, color = "black", size = 1.2)+ 
  geom_line(aes(y= cum_indiv_hectares/scaleRight), group = 1, color = "#E69F00", size = 1.2)+ 
  geom_line(aes(y= cum_common_hectares/scaleRight), group = 1, color = "#999933", size = 1.2)+ 
  #geom_point(aes(y= cum_common_hectares/scaleRight), group = 1, color = "#999933")+ 
  geom_line(aes(y= cum_forest_hectares/scaleRight), group = 1, color = "#117733", size = 1.2)+ 
  #geom_point(aes(y= cum_forest_hectares/scaleRight), group = 1, color = "#117733")+
    scale_fill_manual(values = c(#"#aab539", #"#5b70dd", 
      "#d2a035", "#c13fa6", #"#4fc271", 
      "#d33680", #"#4e8f2e", #"#d27cde", 
      "#41844a", "#dc375f", "#5dc3a3", "#b82d24", "#4ab4dd", "#e55744", "#517dc0", #"#e37733", 
      "#7956a3", #"#9db269", #"#a7487a",
      "#2e8871", #"#cc5967", 
      "#677328", #"#a798e0", 
      "#8c6d2c", "#db8ebb", "#a6572c", "#91567c", "#d79f66", "#9f494f", "#e3867c"))+ 
  scale_y_continuous(name = "Total hectares (in Millions)", labels = scales::label_number(unit = "M", scale = 1e-6))+scale_x_discrete(name = "District")+
  theme_classic()+ theme(axis.title = element_text(size = 8), axis.text.x = element_blank(), axis.ticks.x = element_blank()) +theme(legend.position = "bottom")+ scale_color_manual(name = "Land tenure", values = c("#E69F00" = "Individual","#999933" =  "Common",
"#117733" = "Forest"))

topdistrict_tenure_curves

ggarrange(district_tenure_curves, topdistrict_tenure_curves, nrow=2, common.legend = TRUE, legend="right")

```
