---
title: "People-centric restoration: Figures and tables in manuscript"
author: "Pooja Choksi"
date: '2022-06-27'
output: html_document
---

In this script, we use the district level land use, multidimensional poverty, climate vulnerability and population data along with new sources of data for question 4 of this study.  


```{r setup, include=FALSE}
library(ggplot2)
library(forcats)
library(dplyr)
library(qcc)
library(gridExtra)
library(viridis)
#get color blind friendly colors 
library(pals)

```


Read in all the data from previous scripts that we need for plots and tables.

```{r message = FALSE, warning=FALSE, include=TRUE}

#For all questions, we need this data
districts_info = read.csv("District-Climate-MPI-Biophys-Ranked.csv")

```

## SYNERGIES AND TRADE-OFFS BETWEEN SEVERAL FACTORS

The chunk of code below creates a scatterplot where each district's biophysical potential rank and people-centric restoration opportunity rank is plotted. 

We also subset the data into the different quantiles to have a closer look at which districts are in the top and bottom quantiles and how that compares to their biophysical potential.

```{r message=FALSE, warning=FALSE, include=TRUE, echo= FALSE}
#All the land tenures together
#first categorize the three variables

#Remove the duplicates 
districts_info = districts_info [!duplicated(districts_info[c("NAME_1","NAME_2")]),]

districts_info$tenure_max  = apply(districts_info[c("Tt_C_", "Tt_I_", "Tt_F_")], 1, max)

districts_info = districts_info%>%mutate(tenure_max_cat = 
 case_when(tenure_max == Tt_I_ ~ "Individual",
           tenure_max == Tt_C_ ~ "Common",
           tenure_max == Tt_F_ ~ "Forest", 
           TRUE ~ "NA"))

biophys_people_scale1 = ggplot(districts_info) + geom_jitter(data= districts_info, aes(x = strass_rank, y= P_C_R, shape = tenure_max_cat, color = Clmt_vlnrb, size = Lvng_), alpha = 0.6)+
theme_bw()+scale_color_viridis(option = "D")+
  scale_y_continuous(name = "District rank according to people-centric restoration opportunity") + scale_x_continuous(name="District rank according to biophysical restoration potential")+ 
   geom_vline(xintercept =274, linetype="dashed") + geom_hline(yintercept = 275, linetype="dashed")+ labs(color = "Climate Vulnerability", size = "Poverty %", shape = "Dominant tenure regime")+expand_limits(y = 555) 

#alternative plot
biophys_people_scale2 = ggplot(districts_info) + geom_jitter(data= districts_info, aes(x = Strassburg_Scaled_final, y= Pp__M, shape = tenure_max_cat, color = Clmt_vlnrb, size = Lvng_), alpha = 0.6)+theme_bw()+scale_color_viridis(option = "D")+ scale_y_continuous(name = "People-centric restoration opportunity")+ scale_x_continuous(name="Biophysical restoration potential")+ geom_vline(xintercept =0.5, linetype="dashed") + geom_hline(yintercept = 0.5, linetype="dashed")+ labs(color = "Climate Vulnerability", size = "Poverty %", shape = "Dominant tenure regime")

biophys_people_scale2

#report the synergies and trade-offs
#Biophysical factors v/s people-centric factors 
#split the data into 4 equal parts 
summary(districts_info$Ppl_R)

districts_info = districts_info%>%mutate(People_Cat = case_when(
  Ppl_R<=138.2 ~ "High", #under first quantile
  Ppl_R>=138.2 & Ppl_R<275.5 ~ "Medium", #between first quantile and median
  Ppl_R>=275.5 & Ppl_R<412.8 ~ "Low", #between median and third quantile
  Ppl_R>=412.8 & Ppl_R< 550 ~"Very low",
  TRUE~ "NA"))

summary(districts_info$strass_rank)

districts_info = districts_info%>%mutate(Strass_Cat = case_when(
  strass_rank<=137.2 ~ "High",
  strass_rank>=137.2 & strass_rank<274.5 ~ "Medium",
  strass_rank>=274.5 & strass_rank<410.8 ~ "Low",
  strass_rank>=410.8 & strass_rank<548 ~"Very low",
  TRUE~ "NA"))

high_both = districts_info%>%filter(Strass_Cat == "High" & People_Cat == "High")

medium = districts_info%>%filter(Strass_Cat == "Medium" & People_Cat == "High")

very_low = districts_info%>%filter(Strass_Cat == "Very low" & People_Cat == "High")

low = districts_info%>%filter(Strass_Cat == "Low" & People_Cat == "High")

#Which states are the high -high potential districts in?
high_states = high_both%>%group_by(NAME_1)%>%count()

low_states = low%>%group_by(NAME_1)%>%count()
verylow_states = very_low%>%group_by(NAME_1)%>%count()

#Districts above and below the mean (to match the scatterplot)

#high people-high biophysical
ppl_bio_high = districts_info%>%filter(strass_rank<=274  & Ppl_R <=275)
ppl_bio_high_states = ppl_bio_high%>%group_by(NAME_1)%>%count()

tenure_ppl_bio_high = ppl_bio_high%>%group_by(tenure_max_cat)%>%count()
  
ppl_high_bio_low = districts_info%>%filter(strass_rank>=280.1  & Cmbnd_R<= 124.1)

ppl_low_bio_high = districts_info%>%filter(strass_rank<=280.1  & Cmbnd_R>= 124.1)

ppl_bio_low = districts_info%>%filter(strass_rank>=280.1  & Cmbnd_R>= 124.1)

```

## CHARACTERISTICS OF POPULATION IN HIGH PEOPLE_CENTRIC RESTORATION OPPORTUNITY AREAS

1. Number of land-owning and landless households in the district.

```{r pressure, echo=FALSE, message=FALSE, warning=FALSE, include=TRUE}
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
