---
title: "People-centric restoration: Figures and tables in manuscript"
author: "Pooja Choksi"
date: '2022-06-27'
output: html_document
---

In this script, we use the district level land use, multidimensional poverty, climate vulnerability and population data along with new sources of data for question 4 of this study.  


```{r setup, include=FALSE}
library(ggplot2)
library(forcats)
library(dplyr)
library(qcc)
library(gridExtra)
library(viridis)
#get color blind friendly colors 
library(pals)

```


Read in all the data from previous scripts that we need for plots and tables.

```{r message = FALSE, warning=FALSE, include=TRUE}

#For all questions, we need this data
districts_info = read.csv("District-Climate-MPI-Biophys-Ranked.csv")

aspirational_districts = read.csv("Aspirational-Districts-Phase1.csv")

```

## SYNERGIES AND TRADE-OFFS BETWEEN SEVERAL FACTORS

The chunk of code below creates a scatterplot where each district's biophysical potential rank and people-centric restoration opportunity rank is plotted. 

We also subset the data into the different quantiles to have a closer look at which districts are in the top and bottom quantiles and how that compares to their biophysical potential.

```{r message=FALSE, warning=FALSE, include=TRUE, echo= FALSE}

#Make a variable for the presence of aspirational district
aspirational_districts$Aspirational_District = "Aspirational_district"

#recode districts to match with the main dataset 

aspirational_districts = aspirational_districts%>%dplyr::mutate(District.name = recode(District.name, 
"West singhbhum" ="Pashchimi Singhbhum", 
"Chatttarpur" = "Chhatarpur",
"East nimar" = "East Nimar",
"Gadchiroli" = "Garhchiroli",
"Nuapara" = "Nuapada",
"Ferozepur" = "Firozpur",
"Dholpur" = "Dhaulpur",
"Virudhunagar" = "Virudunagar",
"Haridwar" = "Hardwar",
"Udham singh nagar" = "Udham Singh Nagar",
"Dakshin dinajpur" = "Dakshin Dinajpur"))

#Combine aspiration districts with the main dataset
districts_info = merge(districts_info, aspirational_districts[c("District.name", "S.NO.", "Aspirational_District")], by.x = c("NAME_2", "NAME_1"), 
              by.y =c("District.name", "S.NO."), all.x=T)

#All the land tenures together
#first categorize the three variables

#Remove the duplicates 
districts_info = districts_info [!duplicated(districts_info[c("NAME_1","NAME_2")]),]

districts_info$tenure_max  = apply(districts_info[c("Ttl_In_", "Ttl_Cm_", "Ttl_Fr_")], 1, max)

districts_info = districts_info%>%mutate(tenure_max_cat = 
 case_when(tenure_max == Ttl_In_ ~ "Individual",
           tenure_max == Ttl_Cm_ ~ "Common",
           tenure_max == Ttl_Fr_ ~ "Forest", 
           TRUE ~ "NA"))

#subset asiprational districts here to plot 
subset_aspirational = subset(districts_info, Aspirational_District == "Aspirational_district")

biophys_people_scale = ggplot(districts_info) + geom_jitter(data= districts_info, aes(x = strass_rank, y= Cmbnd_R, shape = tenure_max_cat, color = Clmt_v_, size = Lvng_st, border = Aspirational_District), alpha = 0.6)+
  #geom_point(data = subset_aspirational, col = "black", stroke = 3)+
theme_bw()+scale_color_viridis(option = "D")+
  scale_y_continuous(name = "District rank according to people-centric restoration opportunity") + scale_x_continuous(name="District rank according to biophysical restoration potential")+ 
   geom_vline(xintercept =280.1068, linetype="dashed") + geom_hline(yintercept = 124.1441, linetype="dashed")+ labs(color = "Climate Vulnerability", size = "Poverty %", shape = "Dominant tenure regime")

#alternative plot
biophys_people_scale = ggplot(districts_info) + geom_jitter(data= districts_info, aes(x = Strassburg_India_Scaled, y= Ppl_c_M, shape = tenure_max_cat, color = Clmt_v_, size = Lvng_st), alpha = 0.6)+theme_bw()+scale_color_viridis(option = "D")+
+     scale_y_continuous(name = "People-centric restoration opportunity") + scale_x_continuous(name="Biophysical restoration potential")+ 
+     geom_vline(xintercept =0.45, linetype="dashed") + geom_hline(yintercept = 0.48, linetype="dashed")+ labs(color = "Climate Vulnerability", size = "Poverty %", shape = "Dominant tenure regime")

biophys_people_scale

#report the synergies and trade-offs
#Biophysical factors v/s people-centric factors 
#split the data into 4 equal parts 
summary(districts_info$Cmbnd_R)

districts_info = districts_info%>%mutate(People_Cat = case_when(
  Cmbnd_R<=69.0 ~ "High", #under first quantile
  Cmbnd_R>=69.0 & Cmbnd_R<119.0 ~ "Medium", #between first quantile and median
  Cmbnd_R>=119.0 & Cmbnd_R<178.8 ~ "Low", #between median and third quantile
  Cmbnd_R>=178.8 & Cmbnd_R< 300 ~"Very low",
  TRUE~ "NA"))

summary(districts_info$strass_rank)

districts_info = districts_info%>%mutate(Strass_Cat = case_when(
  strass_rank<=140.2 ~ "High",
  strass_rank>=140.2 & strass_rank<280.1 ~ "Medium",
  strass_rank>=280.1 & strass_rank<419.8 ~ "Low",
  strass_rank>=419.8 & strass_rank<560 ~"Very low",
  TRUE~ "NA"))

high_both = districts_info%>%filter(Strass_Cat == "High" & People_Cat == "High")

very_low = districts_info%>%filter(Strass_Cat == "Very low" & People_Cat == "High")

low = districts_info%>%filter(Strass_Cat == "Low" & People_Cat == "High")

#Which states are the high -high potential districts in?
high_states = high_both%>%group_by(NAME_1)%>%count()


#Districts above and below the mean (to match the scatterplot)

#high people-high biophysical
ppl_bio_high = districts_info%>%filter(strass_rank<=280.1  & Cmbnd_R<= 124.1)

ppl_high_bio_low = districts_info%>%filter(strass_rank>=280.1  & Cmbnd_R<= 124.1)

ppl_low_bio_high = districts_info%>%filter(strass_rank<=280.1  & Cmbnd_R>= 124.1)

ppl_bio_low = districts_info%>%filter(strass_rank>=280.1  & Cmbnd_R>= 124.1)

```

## CHARACTERISTICS OF POPULATION IN HIGH PEOPLE_CENTRIC RESTORATION OPPORTUNITY AREAS

1. Number of land-owning and landless households in the district.

```{r pressure, echo=FALSE, message=FALSE, warning=FALSE, include=TRUE}
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
